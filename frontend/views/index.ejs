<%- include('partials/head.ejs') %>
<%- include('partials/header.ejs') %>
<style>
#scan-n-go-content-container {
padding-top:0 !important;
}
</style>
<div class="container">
<div class="bg">
<div style='padding:5px;position: relative;top: 50%;transform: translateY(-50%);'>
<h1 class="text-white display-4 text-center" style='font-weight:bold'>Scan N Go</h1>
<h4 id="welcome-message" class="text-white display-4 text-center">Scan N Go</h4>
<p class="lead text-white text-center">Welcome to Scan-N-Go. Add products to your basket to get started!</p></div>
</div>

  <div class="row" style="margin-top:15px">
    <div class="col-sm">
     <div class="card mb-3">
        <img class="card-img-top" src="https://images.unsplash.com/photo-1608686207856-001b95cf60ca?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=627&q=80" alt="Card image cap">
        <div class="card-body">
          <h5 class="card-title">All Products</h5>
          <p class="card-text">Check out our all products page to add products to your basket</p>
          <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
          <a href="allproducts" class="btn btn-primary" style='width:100%'>Go To All Products</a>
        </div>
      </div>
    </div>
    <div class="col-sm">
      <div class="card mb-3">
        <img class="card-img-top" src="https://images.unsplash.com/photo-1525328437458-0c4d4db7cab4?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80" alt="Card image cap">
        <div class="card-body">
          <h5 class="card-title">Your Basket</h5>
          <p class="card-text">Head over to the basket page to view the products in your basket and checkout</p>
          <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
          <a href="basket" class="btn btn-primary" style='width:100%'>Go To Basket Page</a>
        </div>
      </div>
    </div>
    <div class="col-sm">

      <div class="card mb-3">
        <img class="card-img-top" src="https://images.unsplash.com/photo-1619946755819-d34a04637cdd?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=687&q=80" alt="Card image cap">
        <div class="card-body" style="position: relative;" >
          <h5 class="card-title">Logout</h5>
          <p class="card-text">Finished up? Click here to logout, we'll miss you!</p>
          <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
          <a href="#" class="btn btn-primary" style='width:100%' onclick="displayLogoutMsg()">Logout</a>
        </div>
      </div>
    </div>
  </div>
</div>
<div style='display:none'id="scanning-area">
</div>
<script>


function createWelcome() {
  var username = sessionStorage.getItem('username')
  document.getElementById("welcome-message").innerHTML = "Welcome, " + username + "!"
}

window.onload = function() {
  checkLogin();
  createWelcome();
};


</script>

<script>
      var _scannerIsRunning = false;

      function startScanner() {
          Quagga.init({
              inputStream: {
                  name: "Live",
                  type: "LiveStream",
                  target: document.querySelector('#scanner-container'),
                  constraints: {
                      width: 480,
                      height: 320,
                      facingMode: "environment"
                  },
              },
              decoder: {
                  readers: [
                      "code_128_reader",
                      "ean_reader",
                      "ean_8_reader",
                      "code_39_reader",
                      "code_39_vin_reader",
                      "codabar_reader",
                      "upc_reader",
                      "upc_e_reader",
                      "i2of5_reader"
                  ],
                  debug: {
                      showCanvas: true,
                      showPatches: true,
                      showFoundPatches: true,
                      showSkeleton: true,
                      showLabels: true,
                      showPatchLabels: true,
                      showRemainingPatchLabels: true,
                      boxFromPatches: {
                          showTransformed: true,
                          showTransformedBox: true,
                          showBB: true
                      }
                  }
              },

          }, function (err) {
              if (err) {
                  console.log(err);
                  return
              }

              console.log("Initialization finished. Ready to start");
              Quagga.start();

              // Set flag to is running
              _scannerIsRunning = true;
          });

          Quagga.onProcessed(function (result) {
              var drawingCtx = Quagga.canvas.ctx.overlay,
              drawingCanvas = Quagga.canvas.dom.overlay;

              if (result) {
                  if (result.boxes) {
                      drawingCtx.clearRect(0, 0, parseInt(drawingCanvas.getAttribute("width")), parseInt(drawingCanvas.getAttribute("height")));
                      result.boxes.filter(function (box) {
                          return box !== result.box;
                      }).forEach(function (box) {
                          Quagga.ImageDebug.drawPath(box, { x: 0, y: 1 }, drawingCtx, { color: "green", lineWidth: 2 });
                      });
                  }

                  if (result.box) {
                      Quagga.ImageDebug.drawPath(result.box, { x: 0, y: 1 }, drawingCtx, { color: "#00F", lineWidth: 2 });
                  }

                  if (result.codeResult && result.codeResult.code) {
                      Quagga.ImageDebug.drawPath(result.line, { x: 'x', y: 'y' }, drawingCtx, { color: 'red', lineWidth: 3 });
                  }
              }
          });


          Quagga.onDetected(function (result) {
              console.log("Barcode detected and processed : [" + result.codeResult.code + "]", result);
          });
      }


      // Start/stop scanner
      document.getElementById("btn").addEventListener("click", function () {
          if (_scannerIsRunning) {
              Quagga.stop();
          } else {
              startScanner();
          }
      }, false);
  </script>

<%- include('partials/footer.ejs') %>
